<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wrenchly – Auto-onderhoud</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 1.5rem;
      background: #fafafa;
      color: #222;
    }
    h1 {
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.95rem;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem;
      text-align: left;
      vertical-align: top;
    }
    th {
      background: #eee;
      font-weight: 600;
    }
    tr:hover {
      background-color: #f5f9ff;
    }
    .tab-button {
      margin-right: 1rem;
      padding: 0.4rem 0.9rem;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 6px;
      transition: background 0.2s;
    }
    .tab-button.active {
      background-color: #ddd;
      font-weight: bold;
    }
    .search-box {
      margin: 0.8rem 0;
    }
    .search-box input {
      padding: 0.4rem 0.6rem;
      width: 250px;
      max-width: 100%;
    }
    .status {
      font-weight: bold;
    }
    .status.green { color: green; }
    .status.orange { color: orange; }
    .status.red { color: red; }

    @media (max-width: 600px) {
      table, th, td {
        font-size: 0.85rem;
      }
      .tab-button {
        margin-bottom: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <!-- Tabs -->
  <div>
    <button class="tab-button active" data-tab="reparaties">Reparaties</button>
    <button class="tab-button" data-tab="service">Serviceboekje</button>
  </div>

  <!-- Zoekfunctie voor reparaties -->
  <div class="search-box" id="searchContainer">
    <label for="searchInput">Zoeken in reparaties:</label>
    <input type="text" id="searchInput" placeholder="Bijv. airco, remmen, banden..." />
  </div>

  <!-- Reparaties tabel -->
  <table id="reparaties">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Garage</th>
        <th>Totaalbedrag</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Serviceboekje -->
  <div id="serviceContainer" style="display:none;">
    <label for="serviceFilter">Filter servicebeurten:</label>
    <select id="serviceFilter">
      <option value="alle">Alle</option>
      <option value="historisch">Historisch</option>
      <option value="toekomstig">Toekomstig</option>
    </select>

    <table id="service">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Garage</th>
          <th>Type</th>
          <th>Soort onderhoud</th>
          <th>Kilometerstand</th>
          <th>Interval</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab-button');
    const reparatiesTable = document.getElementById('reparaties');
    const serviceContainer = document.getElementById('serviceContainer');
    const searchContainer = document.getElementById('searchContainer');

    // Wisselen tussen tabs
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        if (tab.dataset.tab === 'reparaties') {
          reparatiesTable.style.display = '';
          searchContainer.style.display = '';
          serviceContainer.style.display = 'none';
        } else {
          reparatiesTable.style.display = 'none';
          searchContainer.style.display = 'none';
          serviceContainer.style.display = '';
        }
      });
    });

    // Status bepalen
    function bepaalStatus(beurtDatum, beurtKm, huidigeKm) {
      const vandaag = new Date();
      const datumVerschil = (new Date(beurtDatum) - vandaag) / (1000 * 60 * 60 * 24);
      const kmVerschil = beurtKm - huidigeKm;

      if (datumVerschil < 0 && beurtKm <= huidigeKm)
        return { label: "✅ Uitgevoerd", kleur: "green" };

      if (datumVerschil < 60 || kmVerschil < 5000)
        return { label: "⏳ Binnenkort", kleur: "orange" };

      if (datumVerschil < 0 && beurtKm > huidigeKm)
        return { label: "⚠️ Te laat", kleur: "red" };

      return { label: "✅ Oké", kleur: "green" };
    }

    // Data laden
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const reparaties = data.bonnen || [];
        const serviceData = data.service || [];
        const huidigeKm = 366000;

        // Reparaties vullen
        const reparatieTbody = document.querySelector('#reparaties tbody');
        function renderReparaties(filter = '') {
          reparatieTbody.innerHTML = '';
          reparaties
            .filter(f => f.omschrijving.toLowerCase().includes(filter.toLowerCase()))
            .forEach((factuur, index) => {
              const mainRow = document.createElement('tr');
              mainRow.style.cursor = 'pointer';
              mainRow.innerHTML = `
                <td>${factuur.factuurdatum || '-'}</td>
                <td>${factuur.garage || '-'}</td>
                <td>€ ${factuur.totaal ? factuur.totaal.toFixed(2) : '-'}</td>
              `;
              reparatieTbody.appendChild(mainRow);

              const detailRows = [];
              const details = [
                {label: "Factuurnummer", value: factuur.factuurnummer},
                {label: "Kilometerstand", value: factuur.kilometerstand},
                {label: "Omschrijving", value: factuur.omschrijving},
                {label: "Categorie", value: factuur.categorie}
              ];
              details.forEach(d => {
                const row = document.createElement('tr');
                row.style.display = 'none';
                row.innerHTML = `<td colspan="3" style="padding-left: 1.5rem;">${d.label}: ${d.value || '-'}</td>`;
                reparatieTbody.appendChild(row);
                detailRows.push(row);
              });
              mainRow.addEventListener('click', () => {
                detailRows.forEach(r => {
                  r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
                });
              });
            });
        }
        renderReparaties();

        document.getElementById('searchInput').addEventListener('input', e => {
          renderReparaties(e.target.value);
        });

        // Serviceboekje vullen
        const serviceTbody = document.querySelector('#service tbody');
        const serviceFilter = document.getElementById('serviceFilter');

        function renderService() {
          serviceTbody.innerHTML = '';
          const filter = serviceFilter.value;
          const vandaag = new Date();

          serviceData.forEach(beurt => {
            const beurtDatum = new Date(beurt.datum);
            const status = bepaalStatus(beurt.datum, beurt.kilometerstand, huidigeKm);
            const isHistorisch = beurtDatum < vandaag;
            const isToekomstig = beurtDatum > vandaag;

            if (filter === 'historisch' && !isHistorisch) return;
            if (filter === 'toekomstig' && !isToekomstig) return;

            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${beurt.datum}</td>
              <td>${beurt.garage}</td>
              <td>${beurt.type_beurt}</td>
              <td>${beurt.soort_onderhoud}</td>
              <td>${beurt.kilometerstand.toLocaleString()} km</td>
              <td>${beurt.volgende_interval}</td>
              <td class="status ${status.kleur}">${status.label}</td>
            `;
            serviceTbody.appendChild(row);
          });
        }

        serviceFilter.addEventListener('change', renderService);
        renderService();
      })
      .catch(err => console.error("Fout bij laden data.json:", err));
  </script>
</body>
</html>
