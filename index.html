<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto-onderhoud MVP</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      background: #fafafa;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background: #eee;
    }
    tr:hover {
      background-color: #f0f8ff;
    }
    .tabs {
      margin-bottom: 1rem;
    }
    .tab-button {
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: 1px solid #ccc;
      border-bottom: none;
      background: #eee;
      margin-right: 0.5rem;
      border-radius: 5px 5px 0 0;
    }
    .tab-button.active {
      background: #fff;
      font-weight: bold;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 0 5px 5px 5px;
      background: #fff;
    }
    select {
      margin-bottom: 0.5rem;
    }
    input[type="text"] {
      margin-bottom: 0.5rem;
      padding: 0.3rem;
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <div class="tabs">
    <button class="tab-button active" data-tab="reparaties">Reparaties</button>
    <button class="tab-button" data-tab="service">Serviceboekje</button>
  </div>

  <!-- Reparaties Tab -->
  <div id="reparaties" class="tab-content active">
    <label>
      Zoek:
      <input type="text" id="searchReparaties" placeholder="Zoek op garage, omschrijving...">
    </label>
    <label>
      Categorie:
      <select id="filterCategorie">
        <option value="Alle">Alle</option>
        <option value="Onderhoud">Onderhoud</option>
        <option value="APK">APK</option>
        <option value="Banden">Banden</option>
        <option value="Airco">Airco</option>
      </select>
    </label>

    <table id="reparatiesTable">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Garage</th>
          <th>Totaalbedrag</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Serviceboekje Tab -->
  <div id="service" class="tab-content">
    <label>
      Type:
      <select id="filterService">
        <option value="Alle">Alle</option>
        <option value="Historisch">Historisch</option>
        <option value="Toekomstig">Toekomstig</option>
      </select>
    </label>

    <table id="serviceTable">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Garage</th>
          <th>Totaalbedrag</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Tabs
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));

        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const reparatiesTable = document.querySelector('#reparatiesTable tbody');
        const serviceTable = document.querySelector('#serviceTable tbody');

        // --- REPARATIES TAB ---
        const reparaties = data.bonnen || [];
        function renderReparaties(filterCat = 'Alle', searchTerm = '') {
          reparatiesTable.innerHTML = '';
          reparaties
            .filter(r => filterCat === 'Alle' || r.categorie === filterCat)
            .filter(r => r.omschrijving.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         r.garage.toLowerCase().includes(searchTerm.toLowerCase()))
            .forEach((factuur, index) => {
              const mainRow = document.createElement('tr');
              mainRow.style.cursor = 'pointer';
              mainRow.innerHTML = `
                <td>${factuur.factuurdatum}</td>
                <td>${factuur.garage}</td>
                <td>€ ${factuur.totaal.toFixed(2)}</td>
              `;
              reparatiesTable.appendChild(mainRow);

              const detailRows = [];
              const details = [
                `Kenteken: ${factuur.kenteken}`,
                `Merk: ${factuur.merk}`,
                `Uitvoering: ${factuur.uitvoering}`,
                `Kilometerstand: ${factuur.kilometerstand}`,
                `Omschrijving: ${factuur.omschrijving}`,
                `Bedrag excl. btw: €${factuur.bedrag_excl_btw.toFixed(2)}`,
                `BTW: €${factuur.btw.toFixed(2)}`
              ];
              details.forEach(d => {
                const row = document.createElement('tr');
                row.style.display = 'none';
                row.style.backgroundColor = index % 2 === 0 ? '#f9fcff' : '#f2f9ff';
                row.innerHTML = `<td colspan="3" style="padding-left:1rem;">- ${d}</td>`;
                reparatiesTable.appendChild(row);
                detailRows.push(row);
              });

              mainRow.addEventListener('click', () => {
                detailRows.forEach(r => {
                  r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
                });
              });
            });
        }

        renderReparaties();

        document.getElementById('filterCategorie').addEventListener('change', e => {
          renderReparaties(e.target.value, document.getElementById('searchReparaties').value);
        });
        document.getElementById('searchReparaties').addEventListener('input', e => {
          renderReparaties(document.getElementById('filterCategorie').value, e.target.value);
        });

        // --- SERVICE TAB ---
        const serviceTableData = reparaties; // voorlopig dezelfde data als reparaties
        function renderService(filterType = 'Alle') {
          serviceTable.innerHTML = '';
          serviceTableData
            .filter(s => {
              if(filterType === 'Alle') return true;
              if(filterType === 'Historisch') return new Date(s.reparatiedatum) < new Date();
              if(filterType === 'Toekomstig') return new Date(s.reparatiedatum) >= new Date();
            })
            .forEach((factuur, index) => {
              const mainRow = document.createElement('tr');
              mainRow.style.cursor = 'pointer';
              mainRow.innerHTML = `
                <td>${factuur.reparatiedatum}</td>
                <td>${factuur.garage}</td>
                <td>€ ${factuur.totaal.toFixed(2)}</td>
              `;
              serviceTable.appendChild(mainRow);

              const detailRows = [];
              const details = [
                `Kenteken: ${factuur.kenteken}`,
                `Merk: ${factuur.merk}`,
                `Uitvoering: ${factuur.uitvoering}`,
                `Kilometerstand: ${factuur.kilometerstand}`,
                `Omschrijving: ${factuur.omschrijving}`,
                `Bedrag excl. btw: €${factuur.bedrag_excl_btw.toFixed(2)}`,
                `BTW: €${factuur.btw.toFixed(2)}`
              ];
              details.forEach(d => {
                const row = document.createElement('tr');
                row.style.display = 'none';
                row.style.backgroundColor = index % 2 === 0 ? '#f9fcff' : '#f2f9ff';
                row.innerHTML = `<td colspan="3" style="padding-left:1rem;">- ${d}</td>`;
                serviceTable.appendChild(row);
                detailRows.push(row);
              });

              mainRow.addEventListener('click', () => {
                detailRows.forEach(r => {
                  r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
                });
              });
            });
        }

        renderService();

        document.getElementById('filterService').addEventListener('change', e => {
          renderService(e.target.value);
        });

      })
      .catch(err => console.error("Fout bij het laden van data.json:", err));
  </script>
</body>
</html>
