<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto-onderhoud MVP</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@400;600&display=swap');

    body {
      font-family: "Host Grotesk", system-ui, sans-serif;
      margin: 2rem;
      background: #fafafa;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem;
      text-align: left;
    }
    th { background: #eee; }
    tr:hover { background-color: #f0f8ff; }

    .tab-button {
      margin-right: 1rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 6px;
      transition: all .2s ease;
    }
    .tab-button.active {
      background-color: #e8e8e8;
      font-weight: bold;
    }
    #serviceFilter {
      margin-top: 0.5rem;
      padding: 0.25rem 0.5rem;
    }

    /* Responsiveness */
    @media (max-width: 700px) {
      table, thead, tbody, th, td, tr { display: block; }
      th { display: none; }
      tr { margin-bottom: 1rem; border-bottom: 2px solid #ddd; }
      td { border: none; padding: .3rem 0; }
      td::before {
        content: attr(data-label);
        font-weight: 600;
        display: block;
        color: #666;
      }
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <!-- Tabs -->
  <div>
    <button class="tab-button active" data-tab="reparaties">Reparaties</button>
    <button class="tab-button" data-tab="service">Serviceboekje</button>
  </div>

  <!-- Reparaties tabel -->
  <table id="reparaties">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Garage</th>
        <th>Totaalbedrag</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Serviceboekje -->
  <div id="serviceContainer" style="display:none;">
    <label for="serviceFilter">Filter servicebeurten:</label>
    <select id="serviceFilter">
      <option value="alle">Alle</option>
      <option value="historisch">Historisch</option>
      <option value="toekomstig">Toekomstig</option>
    </select>

    <table id="service">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Soort onderhoud</th>
          <th>Kilometerstand</th>
          <th>Uitgevoerd door</th>
          <th>Opmerkingen</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // === Tabs ===
    const tabs = document.querySelectorAll('.tab-button');
    const reparatiesTable = document.getElementById('reparaties');
    const serviceContainer = document.getElementById('serviceContainer');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        if (tab.dataset.tab === 'reparaties') {
          reparatiesTable.style.display = '';
          serviceContainer.style.display = 'none';
        } else {
          reparatiesTable.style.display = 'none';
          serviceContainer.style.display = '';
        }
      });
    });

    // === JSON laden ===
    fetch('data.json')
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
      })
      .then(data => {
        renderReparaties(data.bonnen || []);
        renderService(data.service || []);
      })
      .catch(e => console.error("Fout bij het laden van data.json:", e));

    // === Samenvatting genereren ===
    function genereerSamenvatting(omschrijving = "") {
      const tekst = omschrijving.toLowerCase();
      let items = [];
      if (tekst.includes("rem")) items.push("remmen gecontroleerd of vervangen");
      if (tekst.includes("olie")) items.push("motorolie ververst");
      if (tekst.includes("filter")) items.push("filters vervangen");
      if (tekst.includes("apk")) items.push("APK uitgevoerd");
      if (tekst.includes("band")) items.push("banden gewisseld of gecontroleerd");
      if (tekst.includes("airco")) items.push("airco onderhouden of gevuld");
      if (tekst.includes("distributieriem")) items.push("distributieriem gecontroleerd of vervangen");
      if (!items.length) return "Algemene onderhoudswerkzaamheden uitgevoerd.";
      return "Bij deze onderhoudsbeurt zijn " + items.join(", ") + ".";
    }

    // === Reparaties renderen ===
    function renderReparaties(bonnen) {
      const tbody = document.querySelector('#reparaties tbody');
      tbody.innerHTML = '';
      bonnen.forEach((factuur, index) => {
        const mainRow = document.createElement('tr');
        mainRow.style.cursor = 'pointer';
        mainRow.innerHTML = `
          <td data-label="Datum">${factuur.factuurdatum || '-'}</td>
          <td data-label="Garage">${factuur.garage || '-'}</td>
          <td data-label="Totaal">â‚¬ ${factuur.totaal ? factuur.totaal.toFixed(2) : '-'}</td>
        `;
        tbody.appendChild(mainRow);

        // detail + samenvatting
        const samenvatting = genereerSamenvatting(factuur.omschrijving);
        const details = [
          {label: "Factuurnummer", value: factuur.factuurnummer},
          {label: "Kilometerstand", value: factuur.kilometerstand},
          {label: "Omschrijving", value: factuur.omschrijving},
          {label: "Categorie", value: factuur.categorie},
          {label: "Samenvatting", value: samenvatting}
        ];

        const detailRows = details.map(d => {
          const row = document.createElement('tr');
          row.style.display = 'none';
          row.style.backgroundColor = index % 2 === 0 ? '#f9fcff' : '#f2f9ff';
          row.innerHTML = `<td colspan="3" style="padding-left: 1.5rem;"><strong>${d.label}:</strong> ${d.value || '-'}</td>`;
          tbody.appendChild(row);
          return row;
        });

        mainRow.addEventListener('click', () => {
          detailRows.forEach(r => {
            r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
          });
        });
      });
    }

    // === Serviceboekje renderen ===
    function renderService(serviceData) {
      const serviceTbody = document.querySelector('#service tbody');
      const serviceFilter = document.getElementById('serviceFilter');
      const vandaag = new Date();

      function render() {
        serviceTbody.innerHTML = '';
        serviceData.forEach(beurt => {
          const beurtDatum = new Date(beurt.datum);
          const filter = serviceFilter.value;
          if ((filter === 'historisch' && beurtDatum > vandaag) ||
              (filter === 'toekomstig' && beurtDatum <= vandaag)) return;
          const row = document.createElement('tr');
          row.innerHTML = `
            <td data-label="Datum">${beurt.datum || '-'}</td>
            <td data-label="Soort">${beurt.soort_onderhoud || '-'}</td>
            <td data-label="Km">${beurt.kilometerstand || '-'}</td>
            <td data-label="Uitgevoerd door">${beurt.uitgevoerd_door || '-'}</td>
            <td data-label="Opmerkingen">${beurt.opmerkingen || ''}</td>
          `;
          serviceTbody.appendChild(row);
        });
      }

      serviceFilter.addEventListener('change', render);
      render();
    }
  </script>
</body>
</html>
