<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto-onderhoud MVP</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      background: #fafafa;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background: #eee;
    }
    tr:hover {
      background-color: #f0f8ff;
    }
    .tab-button {
      margin-right: 1rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 4px;
    }
    .tab-button.active {
      background-color: #eee;
      font-weight: bold;
    }
    #serviceFilter {
      margin-top: 0.5rem;
      padding: 0.25rem 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <!-- Tabs -->
  <div>
    <button class="tab-button active" data-tab="reparaties">Reparaties</button>
    <button class="tab-button" data-tab="service">Serviceboekje</button>
  </div>

  <!-- Reparaties tabel -->
  <table id="reparaties">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Garage</th>
        <th>Totaalbedrag</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Serviceboekje filter en tabel -->
  <div id="serviceContainer" style="display:none;">
    <label for="serviceFilter">Filter servicebeurten:</label>
    <select id="serviceFilter">
      <option value="alle">Alle</option>
      <option value="historisch">Historisch</option>
      <option value="toekomstig">Toekomstig</option>
    </select>

    <table id="service">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Soort onderhoud</th>
          <th>Kilometerstand</th>
          <th>Uitgevoerd door</th>
          <th>Opmerkingen</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // TAB functionaliteit
    const tabs = document.querySelectorAll('.tab-button');
    const reparatiesTable = document.getElementById('reparaties');
    const serviceContainer = document.getElementById('serviceContainer');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        if (tab.dataset.tab === 'reparaties') {
          reparatiesTable.style.display = '';
          serviceContainer.style.display = 'none';
        } else {
          reparatiesTable.style.display = 'none';
          serviceContainer.style.display = '';
        }
      });
    });

    // REPARATIES laden
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector('#reparaties tbody');
        if (!data.bonnen || !Array.isArray(data.bonnen)) {
          console.error("Geen bonnen-array gevonden in data.json");
          return;
        }

        data.bonnen.forEach((factuur, index) => {
          const mainRow = document.createElement('tr');
          mainRow.style.cursor = 'pointer';
          mainRow.innerHTML = `
            <td>${factuur.factuurdatum}</td>
            <td>${factuur.garage}</td>
            <td>â‚¬ ${factuur.totaal.toFixed(2)}</td>
          `;
          tbody.appendChild(mainRow);

          // detailregels
          const detailRows = [];
          const details = [
            {label: "Factuurnummer", value: factuur.factuurnummer},
            {label: "Kilometerstand", value: factuur.kilometerstand},
            {label: "Merk / Uitvoering", value: factuur.merk + ' ' + factuur.uitvoering},
            {label: "Omschrijving", value: factuur.omschrijving},
            {label: "Categorie", value: factuur.categorie}
          ];
          details.forEach(d => {
            const row = document.createElement('tr');
            row.style.display = 'none';
            row.style.backgroundColor = index % 2 === 0 ? '#f9fcff' : '#f2f9ff';
            row.innerHTML = `<td colspan="3" style="padding-left: 1.5rem;">${d.label}: ${d.value}</td>`;
            tbody.appendChild(row);
            detailRows.push(row);
          });

          mainRow.addEventListener('click', () => {
            detailRows.forEach(r => {
              r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
            });
          });
        });

        // SERVICEBEURTEN renderen
        const serviceData = data.service || []; // service array toevoegen in data.json
        const serviceTbody = document.querySelector('#service tbody');
        const serviceFilter = document.getElementById('serviceFilter');

        function renderService() {
          serviceTbody.innerHTML = '';
          const filter = serviceFilter.value;
          const vandaag = new Date();

          serviceData.forEach(beurt => {
            const beurtDatum = new Date(beurt.datum);
            if ((filter === 'historisch' && beurtDatum > vandaag) ||
                (filter === 'toekomstig' && beurtDatum <= vandaag)) {
              return;
            }
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${beurt.datum}</td>
              <td>${beurt.soort_onderhoud}</td>
              <td>${beurt.kilometerstand}</td>
              <td>${beurt.uitgevoerd_door}</td>
              <td>${beurt.opmerkingen || ''}</td>
            `;
            serviceTbody.appendChild(row);
          });
        }

        serviceFilter.addEventListener('change', renderService);
        renderService();
      })
      .catch(err => console.error("Fout bij het laden van data.json:", err));
  </script>
</body>
</html>
