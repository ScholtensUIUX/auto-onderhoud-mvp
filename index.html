<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="color-scheme" content="light dark" />
  <meta name="supported-color-schemes" content="light dark" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wrenchly – Auto-onderhoud</title>
  <style>
    /* ====== Kleurvariabelen ====== */
    :root {
      --bg-color: #fafafa;
      --text-color: #222;
      --table-bg: #ffffff;
      --border-color: #ddd;
      --header-bg: #eee;
      --hover-bg: #f5f9ff;
      --accent: #18ff83;
    }

    /* ====== DARK MODE ====== */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #f5f5f7;
        --table-bg: #1e1e1e;
        --border-color: #333;
        --header-bg: #2a2a2a;
        --hover-bg: #2f2f2f;
        --accent: #18ff83;
      }
    }

    /* ====== Basisopmaak ====== */
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 1.5rem;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s ease, color 0.3s ease;
    }

    h1 {
      margin-bottom: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.95rem;
      background: var(--table-bg);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      border-bottom: 1px solid var(--border-color);
      padding: 0.6rem;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: var(--header-bg);
      font-weight: 600;
    }

    tr:hover {
      background-color: var(--hover-bg);
    }

    .tab-button {
      margin-right: 1rem;
      padding: 0.45rem 1rem;
      cursor: pointer;
      border: 1px solid var(--border-color);
      background-color: var(--table-bg);
      border-radius: 6px;
      transition: all 0.2s;
      color: var(--text-color);
    }

    .tab-button.active {
      background-color: var(--accent);
      color: #000;
      font-weight: bold;
    }

    .search-box {
      margin: 0.8rem 0;
    }

    .search-box input {
      padding: 0.4rem 0.6rem;
      width: 250px;
      max-width: 100%;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--table-bg);
      color: var(--text-color);
    }

    .status.green { color: #4caf50; font-weight: bold; }
    .status.orange { color: #ff9800; font-weight: bold; }
    .status.red { color: #f44336; font-weight: bold; }

    @media (max-width: 600px) {
      table, th, td { font-size: 0.85rem; }
      .tab-button { margin-bottom: 0.5rem; display: inline-block; }
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <div>
    <button class="tab-button active" data-tab="reparaties">Reparaties</button>
    <button class="tab-button" data-tab="service">Serviceboekje</button>
  </div>

  <div class="search-box" id="searchContainer">
    <label for="searchInput">Zoeken in reparaties:</label>
    <input type="text" id="searchInput" placeholder="Bijv. airco, remmen, banden..." />
  </div>

  <table id="reparaties">
    <thead>
      <tr><th>Datum</th><th>Garage</th><th>Totaalbedrag</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="serviceContainer" style="display:none;">
    <label for="serviceFilter">Filter servicebeurten:</label>
    <select id="serviceFilter">
      <option value="alle">Alle</option>
      <option value="historisch">Historisch</option>
      <option value="toekomstig">Toekomstig</option>
    </select>

    <table id="service">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Garage</th>
          <th>Type</th>
          <th>Soort onderhoud</th>
          <th>Kilometerstand</th>
          <th>Interval</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const tabs = document.querySelectorAll('.tab-button');
    const reparatiesTable = document.getElementById('reparaties');
    const serviceContainer = document.getElementById('serviceContainer');
    const searchContainer = document.getElementById('searchContainer');

    // Wisselen tussen tabs
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        if (tab.dataset.tab === 'reparaties') {
          reparatiesTable.style.display = '';
          searchContainer.style.display = '';
          serviceContainer.style.display = 'none';
        } else {
          reparatiesTable.style.display = 'none';
          searchContainer.style.display = 'none';
          serviceContainer.style.display = '';
        }
      });
    });

    // Bepaal onderhoudsstatus
    function bepaalStatus(beurtDatum, beurtKm, huidigeKm) {
      const vandaag = new Date();
      const datumVerschil = (new Date(beurtDatum) - vandaag) / (1000 * 60 * 60 * 24);
      const kmVerschil = beurtKm - huidigeKm;
      if (datumVerschil < 0 && beurtKm <= huidigeKm) return { label: "✅ Uitgevoerd", kleur: "green" };
      if (datumVerschil < 60 || kmVerschil < 5000) return { label: "⏳ Binnenkort", kleur: "orange" };
      if (datumVerschil < 0 && beurtKm > huidigeKm) return { label: "⚠️ Te laat", kleur: "red" };
      return { label: "✅ Oké", kleur: "green" };
    }

    // JSON laden met cache-bypass
    fetch('data.json?nocache=' + Date.now())
      .then(r => r.json())
      .then(data => {
        const huidigeKm = 366000;
        const reparaties = data.bonnen || [];
        const serviceData = data.service || [];

        const repBody = document.querySelector('#reparaties tbody');
        function renderReparaties(filter = '') {
          repBody.innerHTML = '';
          reparaties.filter(r => r.omschrijving.toLowerCase().includes(filter.toLowerCase()))
            .forEach(f => {
              const row = document.createElement('tr');
              row.style.cursor = 'pointer';
              row.innerHTML = `<td>${f.factuurdatum}</td><td>${f.garage}</td><td>€ ${f.totaal.toFixed(2)}</td>`;
              repBody.appendChild(row);
              const details = [
                `Factuurnummer: ${f.factuurnummer}`,
                `Kilometerstand: ${f.kilometerstand}`,
                `Omschrijving: ${f.omschrijving}`,
                `Categorie: ${f.categorie}`
              ];
              details.forEach(d => {
                const r = document.createElement('tr');
                r.style.display = 'none';
                r.innerHTML = `<td colspan="3" style="padding-left:1.5rem;">${d}</td>`;
                repBody.appendChild(r);
                row.addEventListener('click', () => {
                  r.style.display = r.style.display === 'none' ? 'table-row' : 'none';
                });
              });
            });
        }
        renderReparaties();
        document.getElementById('searchInput').addEventListener('input', e => renderReparaties(e.target.value));

        // Serviceboekje
        const servBody = document.querySelector('#service tbody');
        const servFilter = document.getElementById('serviceFilter');
        function renderService() {
          servBody.innerHTML = '';
          const filter = servFilter.value;
          const vandaag = new Date();
          serviceData.forEach(b => {
            const d = new Date(b.datum);
            const isHist = d < vandaag;
            const isToek = d > vandaag;
            if (filter === 'historisch' && !isHist) return;
            if (filter === 'toekomstig' && !isToek) return;
            const status = bepaalStatus(b.datum, b.kilometerstand, huidigeKm);
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${b.datum}</td>
              <td>${b.garage}</td>
              <td>${b.type_beurt}</td>
              <td>${b.soort_onderhoud}</td>
              <td>${b.kilometerstand.toLocaleString()} km</td>
              <td>${b.volgende_interval}</td>
              <td class="status ${status.kleur}">${status.label}</td>`;
            servBody.appendChild(row);
          });
        }
        servFilter.addEventListener('change', renderService);
        renderService();
      })
      .catch(e => console.error('Fout bij laden JSON:', e));
  </script>
</body>
</html>
