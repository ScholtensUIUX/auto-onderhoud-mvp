<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Auto-onderhoud MVP</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      background: #fafafa;
    }
    h1 { margin-bottom: 1rem; }

    /* Tabs */
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tab {
      padding: 0.5rem 0.9rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f0f0f0;
      cursor: pointer;
      user-select: none;
    }
    .tab.active { background: #0070f3; color: #fff; border-color: #0070f3; }

    /* Controls */
    .controls { display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; }
    select, input[type="text"] {
      padding: 0.35rem 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    label { font-size: 0.95rem; }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    thead th {
      background: #eee;
      padding: 0.6rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    td {
      padding: 0.5rem;
      border-bottom: 1px solid #eee;
    }
    tr.main-row { cursor: pointer; }
    tr.main-row:hover { background: #f0f8ff; }
    .detail-row { display: none; background: #f9fcff; }
    .detail-cell { padding-left: 1.25rem; font-size: 0.95rem; color: #333; }

    .placeholder {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      border: 1px dashed #ddd;
    }
  </style>
</head>
<body>
  <h1>Auto-onderhoud overzicht</h1>

  <!-- Tabs -->
  <div class="tabs">
    <div id="tab-reparaties" class="tab active">Reparaties</div>
    <div id="tab-serviceboekje" class="tab">Serviceboekje</div>
  </div>

  <!-- Controls (only visible for Reparaties) -->
  <div id="controls-reparaties" class="controls">
    <label for="categorieFilter">Categorie:</label>
    <select id="categorieFilter">
      <option value="alle">Alle</option>
    </select>

    <label for="searchInput">Zoeken:</label>
    <input type="text" id="searchInput" placeholder="Zoek op omschrijving, garage of kenteken..." />
  </div>

  <!-- Reparaties table -->
  <div id="view-reparaties">
    <table id="bonnen">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Kilometerstand</th>
          <th>Garage</th>
          <th>Categorie</th>
          <th>Totaal</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Serviceboekje placeholder -->
  <div id="view-serviceboekje" class="placeholder" style="display:none;">
    <p><em>Hier komt later het overzicht van geplande en historische servicebeurten (gebaseerd op model en intervallen).</em></p>
  </div>

  <script>
    // Tab handling
    const tabRep = document.getElementById('tab-reparaties');
    const tabSvc = document.getElementById('tab-serviceboekje');
    const viewRep = document.getElementById('view-reparaties');
    const viewSvc = document.getElementById('view-serviceboekje');
    const controlsRep = document.getElementById('controls-reparaties');

    function showTab(tab) {
      if (tab === 'reparaties') {
        tabRep.classList.add('active');
        tabSvc.classList.remove('active');
        viewRep.style.display = '';
        viewSvc.style.display = 'none';
        controlsRep.style.display = 'flex';
      } else {
        tabSvc.classList.add('active');
        tabRep.classList.remove('active');
        viewRep.style.display = 'none';
        viewSvc.style.display = '';
        controlsRep.style.display = 'none';
      }
    }
    tabRep.addEventListener('click', () => showTab('reparaties'));
    tabSvc.addEventListener('click', () => showTab('serviceboekje'));

    // Data + rendering (keeps the exact click-to-expand behavior + filter + search)
    let bonnenData = [];

    function renderTable(filter = 'alle', zoekterm = '') {
      const tbody = document.querySelector('#bonnen tbody');
      tbody.innerHTML = '';

      // filter & search
      let filtered = bonnenData;
      if (filter !== 'alle') {
        filtered = filtered.filter(b => b.categorie === filter);
      }
      if (zoekterm) {
        const term = zoekterm.toLowerCase();
        filtered = filtered.filter(b =>
          (b.omschrijving && b.omschrijving.toLowerCase().includes(term)) ||
          (b.garage && b.garage.toLowerCase().includes(term)) ||
          (b.kenteken && b.kenteken.toLowerCase().includes(term))
        );
      }

      // render each bon: main row + hidden detail-row (click toggles)
      filtered.forEach((bon, idx) => {
        const mainRow = document.createElement('tr');
        mainRow.className = 'main-row';
        mainRow.innerHTML = `
          <td>${bon.factuurdatum}</td>
          <td>${bon.kilometerstand ?? ''}</td>
          <td>${bon.garage}</td>
          <td>${bon.categorie ?? ''}</td>
          <td>€ ${Number(bon.totaal ?? 0).toFixed(2)}</td>
        `;
        tbody.appendChild(mainRow);

        const detailRow = document.createElement('tr');
        detailRow.className = 'detail-row';
        detailRow.innerHTML = `
          <td colspan="5" class="detail-cell">
            <strong>Factuurnummer:</strong> ${bon.factuurnummer || '-'}<br>
            <strong>Omschrijving:</strong> ${bon.omschrijving || '-'}<br>
            <strong>Kilometerstand:</strong> ${bon.kilometerstand || '-'}<br>
            <strong>Kenteken:</strong> ${bon.kenteken || '-'}<br>
            <strong>Merk / Uitvoering:</strong> ${bon.merk || ''} ${bon.uitvoering || ''}<br>
            <strong>APK geldig tot:</strong> ${bon.apk_geldig_tot || '-'}<br>
            <strong>Bedrag excl. BTW:</strong> € ${Number(bon.bedrag_excl_btw ?? 0).toFixed(2)} |
            <strong>BTW:</strong> € ${Number(bon.btw ?? 0).toFixed(2)} |
            <strong>Totaal:</strong> € ${Number(bon.totaal ?? 0).toFixed(2)}
          </td>
        `;
        tbody.appendChild(detailRow);

        // Toggle detail row
        mainRow.addEventListener('click', () => {
          detailRow.style.display = detailRow.style.display === 'table-row' ? 'none' : 'table-row';
        });
      });
    }

    // Load data.json and initialize filters/search
    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        if (!data.bonnen || !Array.isArray(data.bonnen)) {
          console.error('data.json heeft geen bonnen-array op root (data.bonnen).');
          return;
        }

        // Sorteer op factuurdatum aflopend (nieuwste eerst)
        bonnenData = data.bonnen.slice().sort((a,b) => new Date(b.factuurdatum) - new Date(a.factuurdatum));

        // Vul categorie select
        const select = document.getElementById('categorieFilter');
        const cats = [...new Set(bonnenData.map(b => b.categorie).filter(Boolean))];
        cats.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          select.appendChild(opt);
        });

        // Initial render
        renderTable();

        // Wire up controls
        select.addEventListener('change', () => {
          const zoek = document.getElementById('searchInput').value;
          renderTable(select.value, zoek);
        });
        document.getElementById('searchInput').addEventListener('input', (e) => {
          renderTable(select.value, e.target.value);
        });
      })
      .catch(err => {
        console.error('Fout bij laden data.json:', err);
      });
  </script>
</body>
</html>
